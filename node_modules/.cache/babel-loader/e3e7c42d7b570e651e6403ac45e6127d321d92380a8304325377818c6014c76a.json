{"ast":null,"code":"\"use strict\";\n\n/*!\n * Copyright 2017 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addToBucket = exports.Throttler = exports.noop = exports.promisifySome = void 0;\nconst promisify_1 = require(\"@google-cloud/promisify\");\n/**\n * This replaces usage of promisifyAll(), going forward. Instead of opting\n * some methods out, you will need to opt methods in. Additionally, this\n * function validates method names against the class using TypeScript,\n * to generate compile-time failures for misspellings and changes.\n *\n * Future work in the library should all be Promise-first.\n *\n * @private\n */\nfunction promisifySome(class_, classProto, methods, options) {\n  methods.forEach(methodName => {\n    // Do the same stream checks as promisifyAll().\n    const m = classProto[methodName];\n    classProto[methodName] = (0, promisify_1.promisify)(m, options);\n  });\n}\nexports.promisifySome = promisifySome;\nfunction noop() {}\nexports.noop = noop;\n/**\n * Provides a very simple throttling capability for tasks like error logs.\n * This ensures that no task is actually completed unless N millis have passed\n * since the last one.\n *\n * @private\n */\nclass Throttler {\n  constructor(minMillis) {\n    this.minMillis = minMillis;\n  }\n  /**\n   * Performs the task requested, if enough time has passed since the\n   * last successful call.\n   */\n  doMaybe(task) {\n    const now = Date.now();\n    const doTask = !this.lastTime || this.lastTime && now - this.lastTime >= this.minMillis;\n    if (doTask) {\n      task();\n      this.lastTime = now;\n    }\n  }\n}\nexports.Throttler = Throttler;\n/**\n * Takes care of managing a Map of buckets to the bucket arrays themselves.\n *\n * @private\n */\nfunction addToBucket(map, bucket, item) {\n  var _a;\n  const items = (_a = map.get(bucket)) !== null && _a !== void 0 ? _a : [];\n  items.push(item);\n  map.set(bucket, items);\n}\nexports.addToBucket = addToBucket;","map":{"version":3,"names":["promisify_1","require","promisifySome","class_","classProto","methods","options","forEach","methodName","m","promisify","exports","noop","Throttler","constructor","minMillis","doMaybe","task","now","Date","doTask","lastTime","addToBucket","map","bucket","item","items","_a","get","push","set"],"sources":["../../src/util.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;AAgBA,MAAAA,WAAA,GAAAC,OAAA;AAEA;;;;;;;;;;AAUA,SAAgBC,aAAaA,CAC3BC,MAAgB,EAChBC,UAAa,EACbC,OAAoB,EACpBC,OAA0B;EAE1BD,OAAO,CAACE,OAAO,CAACC,UAAU,IAAG;IAC3B;IACA,MAAMC,CAAC,GAAGL,UAAU,CAACI,UAAU,CAAwB;IACvDJ,UAAU,CAACI,UAAU,CAAC,GAAG,IAAAR,WAAA,CAAAU,SAAS,EAACD,CAAC,EAAEH,OAAO,CAAC;EAChD,CAAC,CAAC;AACJ;AAXAK,OAAA,CAAAT,aAAA,GAAAA,aAAA;AAaA,SAAgBU,IAAIA,CAAA,GAAI;AAAxBD,OAAA,CAAAC,IAAA,GAAAA,IAAA;AAEA;;;;;;;AAOA,MAAaC,SAAS;EAIpBC,YAAYC,SAAiB;IAC3B,IAAI,CAACA,SAAS,GAAGA,SAAS;EAC5B;EAEA;;;;EAIAC,OAAOA,CAACC,IAAc;IACpB,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE;IACtB,MAAME,MAAM,GACV,CAAC,IAAI,CAACC,QAAQ,IACb,IAAI,CAACA,QAAQ,IAAIH,GAAG,GAAG,IAAI,CAACG,QAAQ,IAAI,IAAI,CAACN,SAAU;IAE1D,IAAIK,MAAM,EAAE;MACVH,IAAI,EAAE;MACN,IAAI,CAACI,QAAQ,GAAGH,GAAG;;EAEvB;;AAtBFP,OAAA,CAAAE,SAAA,GAAAA,SAAA;AAyBA;;;;;AAKA,SAAgBS,WAAWA,CAAOC,GAAgB,EAAEC,MAAS,EAAEC,IAAO;;EACpE,MAAMC,KAAK,GAAG,CAAAC,EAAA,GAAAJ,GAAG,CAACK,GAAG,CAACJ,MAAM,CAAC,cAAAG,EAAA,cAAAA,EAAA,GAAI,EAAE;EACnCD,KAAK,CAACG,IAAI,CAACJ,IAAI,CAAC;EAChBF,GAAG,CAACO,GAAG,CAACN,MAAM,EAAEE,KAAK,CAAC;AACxB;AAJAf,OAAA,CAAAW,WAAA,GAAAA,WAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}