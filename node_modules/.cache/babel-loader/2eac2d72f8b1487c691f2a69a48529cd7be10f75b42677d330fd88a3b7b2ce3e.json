{"ast":null,"code":"\"use strict\";\n\n/*!\n * Copyright 2017 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Histogram = void 0;\n/*!\n * The Histogram class is used to capture the lifespan of messages within the\n * the client. These durations are then used to calculate the 99th percentile\n * of ack deadlines for future messages.\n *\n * @private\n * @class\n */\nclass Histogram {\n  constructor(options) {\n    this.options = Object.assign({\n      min: 0,\n      max: Number.MAX_SAFE_INTEGER\n    }, options);\n    this.data = new Map();\n    this.length = 0;\n  }\n  /*!\n   * Adds a value to the histogram.\n   *\n   * @private\n   * @param {numnber} value - The value in milliseconds.\n   */\n  add(value) {\n    value = Math.ceil(value);\n    value = Math.max(value, this.options.min);\n    value = Math.min(value, this.options.max);\n    if (!this.data.has(value)) {\n      this.data.set(value, 0);\n    }\n    const count = this.data.get(value);\n    this.data.set(value, count + 1);\n    this.length += 1;\n  }\n  /*!\n   * Retrieves the nth percentile of recorded values.\n   *\n   * @private\n   * @param {number} percent The requested percentage.\n   * @return {number}\n   */\n  percentile(percent) {\n    percent = Math.min(percent, 100);\n    let target = this.length - this.length * (percent / 100);\n    const keys = Array.from(this.data.keys());\n    let key;\n    for (let i = keys.length - 1; i > -1; i--) {\n      key = keys[i];\n      target -= this.data.get(key);\n      if (target <= 0) {\n        return key;\n      }\n    }\n    return this.options.min;\n  }\n}\nexports.Histogram = Histogram;","map":{"version":3,"names":["Histogram","constructor","options","Object","assign","min","max","Number","MAX_SAFE_INTEGER","data","Map","length","add","value","Math","ceil","has","set","count","get","percentile","percent","target","keys","Array","from","key","i","exports"],"sources":["../../src/histogram.ts"],"sourcesContent":[null],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;AAqBA;;;;;;;;AAQA,MAAaA,SAAS;EAIpBC,YAAYC,OAA0B;IACpC,IAAI,CAACA,OAAO,GAAGC,MAAM,CAACC,MAAM,CAC1B;MAACC,GAAG,EAAE,CAAC;MAAEC,GAAG,EAAEC,MAAM,CAACC;IAAgB,CAAC,EACtCN,OAAO,CACR;IACD,IAAI,CAACO,IAAI,GAAG,IAAIC,GAAG,EAAE;IACrB,IAAI,CAACC,MAAM,GAAG,CAAC;EACjB;EACA;;;;;;EAMAC,GAAGA,CAACC,KAAa;IACfA,KAAK,GAAGC,IAAI,CAACC,IAAI,CAACF,KAAK,CAAC;IACxBA,KAAK,GAAGC,IAAI,CAACR,GAAG,CAACO,KAAK,EAAE,IAAI,CAACX,OAAO,CAACG,GAAI,CAAC;IAC1CQ,KAAK,GAAGC,IAAI,CAACT,GAAG,CAACQ,KAAK,EAAE,IAAI,CAACX,OAAO,CAACI,GAAI,CAAC;IAC1C,IAAI,CAAC,IAAI,CAACG,IAAI,CAACO,GAAG,CAACH,KAAK,CAAC,EAAE;MACzB,IAAI,CAACJ,IAAI,CAACQ,GAAG,CAACJ,KAAK,EAAE,CAAC,CAAC;;IAEzB,MAAMK,KAAK,GAAG,IAAI,CAACT,IAAI,CAACU,GAAG,CAACN,KAAK,CAAE;IACnC,IAAI,CAACJ,IAAI,CAACQ,GAAG,CAACJ,KAAK,EAAEK,KAAK,GAAG,CAAC,CAAC;IAC/B,IAAI,CAACP,MAAM,IAAI,CAAC;EAClB;EACA;;;;;;;EAOAS,UAAUA,CAACC,OAAe;IACxBA,OAAO,GAAGP,IAAI,CAACT,GAAG,CAACgB,OAAO,EAAE,GAAG,CAAC;IAChC,IAAIC,MAAM,GAAG,IAAI,CAACX,MAAM,GAAG,IAAI,CAACA,MAAM,IAAIU,OAAO,GAAG,GAAG,CAAC;IACxD,MAAME,IAAI,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAI,CAAChB,IAAI,CAACc,IAAI,EAAE,CAAC;IACzC,IAAIG,GAAG;IACP,KAAK,IAAIC,CAAC,GAAGJ,IAAI,CAACZ,MAAM,GAAG,CAAC,EAAEgB,CAAC,GAAG,CAAC,CAAC,EAAEA,CAAC,EAAE,EAAE;MACzCD,GAAG,GAAGH,IAAI,CAACI,CAAC,CAAC;MACbL,MAAM,IAAI,IAAI,CAACb,IAAI,CAACU,GAAG,CAACO,GAAG,CAAE;MAC7B,IAAIJ,MAAM,IAAI,CAAC,EAAE;QACf,OAAOI,GAAG;;;IAGd,OAAO,IAAI,CAACxB,OAAO,CAACG,GAAI;EAC1B;;AAjDFuB,OAAA,CAAA5B,SAAA,GAAAA,SAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}